<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nail Salon Dashboard</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial; margin: 0; background:#f6f7fb; }
    header { padding: 16px 20px; background: #111827; color: white; }
    main { padding: 16px 20px; display: grid; gap: 16px; grid-template-columns: 1.2fr 0.8fr; }
    .card { background: white; border-radius: 14px; padding: 14px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    h2 { margin: 0 0 10px; font-size: 16px; }
    .grid { display: grid; gap: 10px; grid-template-columns: repeat(2, minmax(0,1fr)); }
    .staff { border: 1px solid #eef0f6; border-radius: 12px; padding: 10px; }
    .row { display:flex; gap: 8px; align-items:center; justify-content: space-between; }
    .pill { font-size: 12px; padding: 4px 8px; border-radius: 999px; background:#eef2ff; }
    .pill.busy { background:#fee2e2; }
    .muted { color:#6b7280; font-size: 12px; }
    button { border: 0; border-radius: 10px; padding: 9px 10px; cursor: pointer; }
    button.primary { background:#111827; color:white; }
    button.ghost { background:#f3f4f6; }
    input, select { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #e5e7eb; }
    table { width: 100%; border-collapse: collapse; }
    td, th { padding: 10px; border-bottom: 1px solid #eef0f6; text-align:left; font-size: 13px; }
    @media (max-width: 900px){ main { grid-template-columns: 1fr; } .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
<header>
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div>
      <div style="font-weight:700;">Nail Salon Dashboard</div>
      <div class="muted" style="color:#cbd5e1;">Assign khách → cân bằng income theo thợ</div>
    </div>
    <button class="ghost" onclick="resetDay()">Reset Day</button>
  </div>
</header>

<main>
  <section class="card">
    <h2>Employees</h2>
    <div id="staffGrid" class="grid"></div>
  </section>

  <aside class="card">
    <h2>New Customer</h2>
    <div style="display:grid;gap:10px;">
      <div>
        <div class="muted">Tên khách</div>
        <input id="custName" placeholder="VD: Linh / Anna / ..." />
      </div>

      <div>
        <div class="muted">Dịch vụ</div>
        <select id="serviceSelect"></select>
      </div>

      <div>
        <div class="muted">Giá (tạm thời nhập tay — bạn gửi bảng giá sau sẽ tự tính)</div>
        <input id="priceInput" type="number" min="0" placeholder="VD: 45" />
      </div>

      <button class="primary" onclick="assignCustomer()">Assign</button>
      <div id="msg" class="muted"></div>
    </div>

    <hr style="border:0;border-top:1px solid #eef0f6;margin:14px 0;">

    <h2>Current Jobs</h2>
    <div style="overflow:auto;">
      <table>
        <thead>
          <tr><th>Khách</th><th>Dịch vụ</th><th>Giá</th><th>Thợ</th><th>TT</th></tr>
        </thead>
        <tbody id="jobsBody"></tbody>
      </table>
    </div>
  </aside>
</main>

<script>
  // --- DATA (từ file D1- staff.xlsx) ---
  const staff = [
    {id:1, name:"Ha ha", skills:["Design","đấp bột"], status:"available", total:0, current:null},
    {id:2, name:"bánh mì", skills:["Design","đắp bột","cắt da Nga"], status:"available", total:0, current:null},
    {id:3, name:"thùy", skills:["design","extension","heel"], status:"available", total:0, current:null},
    {id:4, name:"Na", skills:["design","extension","heel"], status:"available", total:0, current:null},
    {id:5, name:"Tâm", skills:["des simple","H & F spa"], status:"available", total:0, current:null},
    {id:6, name:"Muối", skills:["des simple","H & F spa"], status:"available", total:0, current:null},
    {id:7, name:"Thoa", skills:["des simple","H & F spa","gel X"], status:"available", total:0, current:null},
    {id:8, name:"Vy", skills:["des simple","french","cắt da Nga","wax (H,F,brow…)"], status:"available", total:0, current:null},
    {id:9, name:"Demi", skills:["des simple","H & F spa","gội","Body"], status:"available", total:0, current:null},
    {id:10, name:"Nhung", skills:["lashes"], status:"available", total:0, current:null},
    {id:11, name:"Dung", skills:["Body","facial"], status:"available", total:0, current:null},
    {id:12, name:"Sathia", skills:["gội","body","wax (all)","facial"], status:"available", total:0, current:null},
    {id:13, name:"Linh", skills:["body","facial"], status:"available", total:0, current:null},
    {id:14, name:"Iris", skills:["gội","body","facial"], status:"available", total:0, current:null},
  ];

  // Placeholder services list (sau bạn gửi bảng giá, mình sẽ generate từ price list)
  const allServices = Array.from(new Set(staff.flatMap(s => s.skills)));

  const jobs = []; // {name, service, price, staffId, status}

  function $(id){ return document.getElementById(id); }

  function renderServices(){
    const sel = $("serviceSelect");
    sel.innerHTML = allServices.map(s => `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`).join("");
  }

  function renderStaff(){
    const grid = $("staffGrid");
    grid.innerHTML = staff.map(s => {
      const pillClass = s.status === "available" ? "pill" : "pill busy";
      const pillText = s.status === "available" ? "Available" : "Busy";
      const current = s.current ? `<div class="muted">Đang làm: <b>${escapeHtml(s.current.name)}</b> • ${escapeHtml(s.current.service)} • $${s.current.price}</div>` : `<div class="muted">Rảnh</div>`;
      return `
        <div class="staff">
          <div class="row">
            <div style="font-weight:700;">${escapeHtml(s.name)}</div>
            <span class="${pillClass}">${pillText}</span>
          </div>
          <div class="muted" style="margin:6px 0;">Skills: ${escapeHtml(s.skills.join(", "))}</div>
          ${current}
          <div class="row" style="margin-top:10px;">
            <div><span class="muted">Total:</span> <b>$${s.total.toFixed(2)}</b></div>
            <button class="ghost" onclick="markDone(${s.id})" ${s.status==="available" ? "disabled" : ""}>Done</button>
          </div>
        </div>
      `;
    }).join("");
  }

  function renderJobs(){
    const body = $("jobsBody");
    body.innerHTML = jobs.map(j => {
      const stName = staff.find(s=>s.id===j.staffId)?.name || "";
      return `<tr>
        <td>${escapeHtml(j.name)}</td>
        <td>${escapeHtml(j.service)}</td>
        <td>$${Number(j.price).toFixed(2)}</td>
        <td>${escapeHtml(stName)}</td>
        <td>${escapeHtml(j.status)}</td>
      </tr>`;
    }).join("");
  }

  // Auto-assign: chọn thợ Available + làm được service + total income thấp nhất
  function pickStaff(service){
    const candidates = staff.filter(s =>
      s.status==="available" &&
      s.skills.map(x=>x.toLowerCase()).includes(service.toLowerCase())
    );
    if(candidates.length===0) return null;
    candidates.sort((a,b) => a.total - b.total);
    return candidates[0];
  }

  function assignCustomer(){
    const name = $("custName").value.trim();
    const service = $("serviceSelect").value;
    const price = Number($("priceInput").value);

    if(!name) return msg("Nhập tên khách trước nha.");
    if(!service) return msg("Chọn dịch vụ nha.");
    if(!Number.isFinite(price) || price<=0) return msg("Nhập giá tạm thời (>0).");

    const chosen = pickStaff(service);
    if(!chosen) return msg("Không có thợ AVAILABLE làm được dịch vụ này.");

    // set busy + current
    chosen.status = "busy";
    chosen.current = { name, service, price };

    jobs.push({ name, service, price, staffId: chosen.id, status: "In progress" });

    $("custName").value = "";
    $("priceInput").value = "";
    msg(`Đã gán khách ${name} cho thợ ${chosen.name}.`);

    renderAll();
  }

  function markDone(staffId){
    const s = staff.find(x=>x.id===staffId);
    if(!s || !s.current) return;

    // update totals
    s.total += Number(s.current.price);

    // update job status
    const j = [...jobs].reverse().find(x => x.staffId===staffId && x.status==="In progress");
    if(j) j.status = "Done";

    // free staff
    s.current = null;
    s.status = "available";

    msg(`Done: ${s.name} đã xong và trở lại Available.`);
    renderAll();
  }

  function resetDay(){
    if(!confirm("Reset toàn bộ doanh thu + jobs hôm nay?")) return;
    staff.forEach(s => { s.status="available"; s.total=0; s.current=null; });
    jobs.length = 0;
    msg("Đã reset.");
    renderAll();
  }

  function msg(t){ $("msg").textContent = t; }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  function renderAll(){
    renderStaff();
    renderJobs();
  }

  // init
  renderServices();
  renderAll();
</script>
</body>
</html>
